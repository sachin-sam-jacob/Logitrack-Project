<div class="profile-container">

  <!-- LOADING -->
  <div *ngIf="isLoading" class="loading">
    <p>Loading...</p>
  </div>

  <!-- PROFILE CARD -->
  <div *ngIf="!isLoading" class="profile-card">
    
    <div class="header">
      <h2>{{ detailsCompleted ? 'Update Profile' : 'Complete Your Profile' }}</h2>
      <p *ngIf="!detailsCompleted" class="warning-text">
        ‚ö†Ô∏è Please complete your profile to access all features
      </p>
      <p *ngIf="detailsCompleted" class="success-text">
        ‚úÖ Your profile is complete. You can update details below.
      </p>
    </div>

    <!-- Driver Verification Status -->
    <div *ngIf="role === 'DRIVER' && detailsCompleted" class="status-card">
      <div class="status-badge" [ngClass]="verificationStatus.toLowerCase()">
        {{ verificationStatus }}
      </div>
      <p *ngIf="verificationStatus === 'PENDING'" class="status-text">
        ‚è≥ Your documents are under review
      </p>
      <p *ngIf="verificationStatus === 'APPROVED'" class="status-text success">
        ‚úÖ Your profile is verified
      </p>
      <p *ngIf="verificationStatus === 'REJECTED'" class="status-text error">
        ‚ùå {{ rejectionReason || 'Your profile was rejected' }}
      </p>
    </div>

    <!-- FIXED: Driver Location Display -->
    <div *ngIf="role === 'DRIVER' && detailsCompleted" class="location-display">
      <h3>üìç Location Information</h3>
      <div class="location-grid">
        <div class="location-item">
          <span class="location-label">Base Location:</span>
          <span class="location-value">{{ baseLocation || 'Not set' }}</span>
        </div>
        <div class="location-item">
          <span class="location-label">Current Location:</span>
          <span class="location-value">{{ currentLocation || baseLocation || 'Not set' }}</span>
        </div>
      </div>
    </div>

   <div *ngIf="role === 'DRIVER' && verificationStatus === 'APPROVED'" class="availability-toggle">
  <label class="toggle-switch">
    <input 
      type="checkbox" 
      [checked]="isAvailable" 
      (change)="toggleAvailability()" 
      [disabled]="hasActiveDelivery"
    />
    <span class="slider" [class.disabled]="hasActiveDelivery"></span>
    </label>
    <span class="toggle-label">
      {{ isAvailable ? '‚úÖ Available for assignments' : '‚ùå Unavailable' }}
    </span>
    <p *ngIf="hasActiveDelivery" class="toggle-hint">
      ‚ö†Ô∏è Complete your current delivery to change availability
    </p>
  </div>

    <!-- BUSINESS FORM -->
    <form *ngIf="role === 'BUSINESS'" [formGroup]="detailsForm" (ngSubmit)="onSubmit()">
      
      <div class="input-group">
        <label>Business Name <span class="required">*</span></label>
        <input type="text" formControlName="businessName" placeholder="Enter your business name" />
        <small class="error" *ngIf="detailsForm.get('businessName')?.invalid && detailsForm.get('businessName')?.touched">
          Business name is required
        </small>
      </div>

      <div class="input-group">
        <label>Location <span class="required">*</span></label>
        <input type="text" formControlName="location" placeholder="City, State" />
        <small class="error" *ngIf="detailsForm.get('location')?.invalid && detailsForm.get('location')?.touched">
          Location is required
        </small>
      </div>

      <div class="input-group">
        <label>Contact Number <span class="required">*</span></label>
        <input type="tel" formControlName="contactNumber" placeholder="10-digit mobile number" maxlength="10" />
        <small class="error" *ngIf="detailsForm.get('contactNumber')?.invalid && detailsForm.get('contactNumber')?.touched">
          Valid 10-digit number required
        </small>
      </div>

      <div class="input-group">
        <label>Business Type <span class="required">*</span></label>
        <select formControlName="businessType">
          <option value="">Select Type</option>
          <option value="Retail">Retail</option>
          <option value="Manufacturing">Manufacturing</option>
          <option value="Logistics">Logistics</option>
          <option value="E-commerce">E-commerce</option>
          <option value="Other">Other</option>
        </select>
        <small class="error" *ngIf="detailsForm.get('businessType')?.invalid && detailsForm.get('businessType')?.touched">
          Please select business type
        </small>
      </div>

      <div class="button-group">
        <button type="submit" class="btn primary-btn" [disabled]="isSubmitting">
          {{ isSubmitting ? 'Saving...' : 'Save Details' }}
        </button>
        <button type="button" class="btn secondary-btn" routerLink="/dashboard">
          Back to Dashboard
        </button>
      </div>
    </form>
    
    <!-- DRIVER FORM -->
    <form *ngIf="role === 'DRIVER'" [formGroup]="detailsForm" (ngSubmit)="onSubmit()">
      
      <div class="input-group">
        <label>License Number <span class="required">*</span></label>
        <input type="text" formControlName="licenseNumber" placeholder="Enter your license number" />
        <small class="error" *ngIf="detailsForm.get('licenseNumber')?.invalid && detailsForm.get('licenseNumber')?.touched">
          License number is required
        </small>
      </div>

      <div class="input-group">
        <label>Vehicle Type <span class="required">*</span></label>
        <select formControlName="vehicleType">
          <option value="">Select Vehicle Type</option>
          <option value="Bike">Bike</option>
          <option value="Van">Van</option>
          <option value="Truck">Truck</option>
          <option value="Mini Truck">Mini Truck</option>
        </select>
        <small class="error" *ngIf="detailsForm.get('vehicleType')?.invalid && detailsForm.get('vehicleType')?.touched">
          Vehicle type is required
        </small>
      </div>

      <div class="input-group">
        <label>Vehicle Number <span class="required">*</span></label>
        <input type="text" formControlName="vehicleNumber" placeholder="TN01AB1234" />
        <small class="error" *ngIf="detailsForm.get('vehicleNumber')?.invalid && detailsForm.get('vehicleNumber')?.touched">
          Vehicle number is required
        </small>
      </div>

      <div class="input-group">
        <label>Contact Number <span class="required">*</span></label>
        <input type="tel" formControlName="contactNumber" placeholder="10-digit mobile number" maxlength="10" />
        <small class="error" *ngIf="detailsForm.get('contactNumber')?.invalid && detailsForm.get('contactNumber')?.touched">
          Valid 10-digit number required
        </small>
      </div>

      <div class="input-group">
        <label>Base Location <span class="required">*</span></label>
        <input type="text" formControlName="location" placeholder="City/Area (e.g., Chennai, Tamil Nadu)" />
        <small class="error" *ngIf="detailsForm.get('location')?.invalid && detailsForm.get('location')?.touched">
          Location is required
        </small>
        <small class="info-text">
          ‚ÑπÔ∏è This is your primary operating location. Your current location will update after deliveries.
        </small>
      </div>

      <div class="input-group" *ngIf="!detailsCompleted">
        <label>Upload License Proof <span class="required">*</span></label>
        <div class="file-upload">
          <input type="file" (change)="onFileChange($event, 'license')" accept="image/*,.pdf" id="license" />
          <label for="license" class="file-label">
            {{ licenseProofName || 'Choose File' }}
          </label>
        </div>
      </div>

      <div class="input-group" *ngIf="!detailsCompleted">
        <label>Upload Vehicle RC <span class="required">*</span></label>
        <div class="file-upload">
          <input type="file" (change)="onFileChange($event, 'rc')" accept="image/*,.pdf" id="rc" />
          <label for="rc" class="file-label">
            {{ vehicleRcName || 'Choose File' }}
          </label>
        </div>
      </div>

      <div class="button-group">
        <button type="submit" class="btn primary-btn" [disabled]="isSubmitting">
          {{ isSubmitting ? 'Saving...' : 'Save Details' }}
        </button>
        <button type="button" class="btn secondary-btn" routerLink="/dashboard">
          Back to Dashboard
        </button>
      </div>
    </form>

    <!-- CUSTOMER FORM -->
    <form *ngIf="role === 'CUSTOMER'" [formGroup]="detailsForm" (ngSubmit)="onSubmit()">
      
      <div class="input-group">
        <label>Contact Number <span class="required">*</span></label>
        <input type="tel" formControlName="contactNumber" placeholder="10-digit mobile number" maxlength="10" />
        <small class="error" *ngIf="detailsForm.get('contactNumber')?.invalid && detailsForm.get('contactNumber')?.touched">
          Valid 10-digit number required
        </small>
      </div>

      <div class="input-group">
        <label>Alternative Contact Number <span class="required">*</span></label>
        <input type="tel" formControlName="alternativeContactNumber" placeholder="Alternate 10-digit number" maxlength="10" />
        <small class="error" *ngIf="detailsForm.get('alternativeContactNumber')?.invalid && detailsForm.get('alternativeContactNumber')?.touched">
          Valid 10-digit number required
        </small>
      </div>

      <div class="input-group">
        <label>Address <span class="required">*</span></label>
        <textarea formControlName="address" rows="3" placeholder="Enter your full address"></textarea>
        <small class="error" *ngIf="detailsForm.get('address')?.invalid && detailsForm.get('address')?.touched">
          Address is required
        </small>
      </div>

      <div class="input-group">
        <label>Location <span class="required">*</span></label>
        <input type="text" formControlName="location" placeholder="City/Area" />
        <small class="error" *ngIf="detailsForm.get('location')?.invalid && detailsForm.get('location')?.touched">
          Location is required
        </small>
      </div>

      <div class="button-group">
        <button type="submit" class="btn primary-btn" [disabled]="isSubmitting">
          {{ isSubmitting ? 'Saving...' : 'Save Details' }}
        </button>
        <button type="button" class="btn secondary-btn" routerLink="/dashboard">
          Back to Dashboard
        </button>
      </div>
    </form>

  </div>
</div>