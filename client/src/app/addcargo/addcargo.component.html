<div class="page-container">

  <!-- HEADER -->
  <div class="page-header">
    <h2>Add Cargo</h2>
    <p>Manage cargo details and assign drivers</p>
  </div>

  <!-- ADD CARGO -->
  <div class="card">
    <h3>New Cargo</h3>

    <form [formGroup]="itemForm" (ngSubmit)="onSubmit()" class="form-grid">

      <div class="form-group">
        <label>Cargo Content <span class="required">*</span></label>
        <input type="text" formControlName="content" placeholder="Electronics" />
        <small *ngIf="itemForm.get('content')?.touched && itemForm.get('content')?.invalid">
          Required
        </small>
      </div>

      <div class="form-group">
        <label>Size <span class="required">*</span></label>
        <input type="text" formControlName="size" placeholder="Small / Medium / Large" />
        <small *ngIf="itemForm.get('size')?.touched && itemForm.get('size')?.invalid">
          Required
        </small>
      </div>

      <div class="form-group">
        <label>Source Location <span class="required">*</span></label>
        <input 
          type="text" 
          formControlName="sourceLocation" 
          placeholder="Pickup location"
          (blur)="onSourceLocationChange()" />
        <small *ngIf="itemForm.get('sourceLocation')?.touched && itemForm.get('sourceLocation')?.invalid">
          Required
        </small>
      </div>

      <div class="form-group">
        <label>Destination Location <span class="required">*</span></label>
        <input type="text" formControlName="destinationLocation" placeholder="Delivery location" />
        <small *ngIf="itemForm.get('destinationLocation')?.touched && itemForm.get('destinationLocation')?.invalid">
          Required
        </small>
      </div>

      <div class="form-group">
        <label>Customer Name <span class="required">*</span></label>
        <input type="text" formControlName="customerName" placeholder="John Doe" />
        <small *ngIf="itemForm.get('customerName')?.touched && itemForm.get('customerName')?.invalid">
          Required
        </small>
      </div>

      <div class="form-group">
        <label>Customer Contact <span class="required">*</span></label>
        <input type="tel" formControlName="customerContact" placeholder="10-digit number" maxlength="10" />
        <small *ngIf="itemForm.get('customerContact')?.touched && itemForm.get('customerContact')?.invalid">
          Valid 10-digit number required
        </small>
      </div>

      <div class="form-group">
        <label>Customer Email <span class="required">*</span></label>
        <input type="email" formControlName="customerEmail" placeholder="customer@example.com" />
        <small *ngIf="itemForm.get('customerEmail')?.touched && itemForm.get('customerEmail')?.invalid">
          Valid email required
        </small>
      </div>

      <div class="form-group">
        <label>Customer Address <span class="required">*</span></label>
        <textarea formControlName="customerAddress" rows="2" placeholder="Full delivery address"></textarea>
        <small *ngIf="itemForm.get('customerAddress')?.touched && itemForm.get('customerAddress')?.invalid">
          Required
        </small>
      </div>

      <div class="form-actions">
        <button type="submit" [disabled]="itemForm.invalid || isSubmitting">
          {{ isSubmitting ? 'Creating...' : 'Add Cargo' }}
        </button>
      </div>
    </form>
  </div>

  <!-- ASSIGN DRIVER -->
  <div class="card">
    <h3>Assign Driver</h3>

    <div class="form-grid">

      <div class="form-group">
        <label>Select Cargo</label>
        <select (change)="selectCargo($event)">
          <option value="">Select cargo</option>
          <option *ngFor="let c of cargList" [value]="c.id">
            {{ c.content }} - {{ c.sourceLocation }} ({{ c.status }})
          </option>
        </select>
      </div>

      <div class="form-group">
        <label>Select Driver</label>
        <select (change)="selectDriver($event)" [disabled]="!selectedCargoSourceLocation">
          <option value="">{{ selectedCargoSourceLocation ? 'Select driver' : 'Select cargo first' }}</option>
          <option *ngFor="let d of filteredDriverList" [value]="d.id">
            {{ d.name }} - {{ d.currentLocation || d.baseLocation }} ({{ d.vehicleType }})
          </option>
        </select>
        <small *ngIf="selectedCargoSourceLocation && filteredDriverList.length === 0" class="warning">
          No drivers available at {{ selectedCargoSourceLocation }}
        </small>
      </div>

      <div class="form-actions">
        <button
          (click)="assignDriver()"
          [disabled]="!assignModel.cargoId || !assignModel.driverId || isAssigning">
          {{ isAssigning ? 'Assigning...' : 'Assign Driver' }}
        </button>
      </div>
    </div>
  </div>